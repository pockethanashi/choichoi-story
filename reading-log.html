<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ„Ÿæƒ…ãƒ­ã‚°è¨˜éŒ²</title>
  <link rel="stylesheet" href="styles/reading-log.css">
  <link rel="stylesheet" href="styles/common.css">
  <link href="https://fonts.googleapis.com/css2?family=Kaisei+HarunoUmi&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Kaisei+HarunoUmi&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

<header>
  <div class="main-header">
    <div class="header-main">
    ã€€<a href="index.html">
        <img src="images/logo.png" alt="ãƒ­ã‚´" class="logo" />
     </a>
      <div class="title-group">
        <h1 class="site-title">ã¡ã‚‡ã„Choiceã‚¹ãƒˆãƒ¼ãƒªãƒ¼</h1>
        <p class="site-subtitle">ã‚¢ãƒ—ãƒ‡ã™ã‚‹å°è©±</p>
      </div>
    </div>
  </div>
  <nav class="sub-header">
    <a href="index.html">ãƒˆãƒƒãƒ—</a>
    <a href="new-post.html">æ–°è¦æŠ•ç¨¿</a>
    <a href="concept.html">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</a>
    <a href="word-generator.html">ãƒã‚¿ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿</a>
    <a href="contact.html">å•ã„åˆã‚ã›</a>
  </nav>
</header>

<main class="concept-page">
  <h2 class="section-title">ğŸ“˜ ã“ã®ä½œå“ã®æ„Ÿæƒ…ãƒ­ã‚°</h2>

  <section>
    <h3>æ–°ã—ãè¨˜éŒ²ã™ã‚‹</h3>
    <p>æ„Ÿã˜ãŸæ°—æŒã¡ã‚’é¸ã‚“ã§ãã ã•ã„ï¼š</p>
    <div class="emotions">
      <button onclick="selectEmotion('ğŸ˜Š')">ğŸ˜Š</button>
      <button onclick="selectEmotion('ğŸ˜¢')">ğŸ˜¢</button>
      <button onclick="selectEmotion('ğŸ˜ ')">ğŸ˜ </button>
      <button onclick="selectEmotion('ğŸ¤”')">ğŸ¤”</button>
    </div>

    <p>æ„Ÿæƒ³ãƒ¡ãƒ¢ï¼š</p>
    <textarea id="comment" rows="4" placeholder="ã©ã‚“ãªã“ã¨ã‚’æ„Ÿã˜ã¾ã—ãŸã‹ï¼Ÿ"></textarea><br>
    <button onclick="saveLog()" style="margin-top: 1em;">è¨˜éŒ²ã™ã‚‹</button>
  </section>

  <section style="margin-top:2em;">
    <h3>ã“ã‚Œã¾ã§ã®æ„Ÿæƒ…ãƒ­ã‚°</h3>
    <div id="logItems"></div>
  </section>

  <a href="index.html">â† ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
<a id="backToDetail" href="#" style="margin-left: 1em;">â†’ å°å™ºã®ãƒšãƒ¼ã‚¸ã¸</a>
</main>

<footer>
  <p>&copy; 2025 ã¡ã‚‡ã„Choiceã‚¹ãƒˆãƒ¼ãƒªãƒ¼</p>
</footer>

<script>
let selectedEmotion = '';

function selectEmotion(emoji) {
  selectedEmotion = emoji;
  document.querySelectorAll('.emotions button').forEach(btn => btn.style.opacity = 0.5);
  event.target.style.opacity = 1;
}

function saveLog() {
  const comment = document.getElementById('comment').value.trim();
  const params = new URLSearchParams(window.location.search);
  const storyId = params.get('id');
  if (!storyId || !selectedEmotion || !comment) {
    alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }
  const key = `storyLog_${storyId}`;
  const logs = JSON.parse(localStorage.getItem(key)) || [];
  logs.push({
    date: new Date().toLocaleString(),
    emotion: selectedEmotion,
    comment: comment
  });
  localStorage.setItem(key, JSON.stringify(logs));
  location.reload();
}

(function renderStoryLogs() {
  const params = new URLSearchParams(window.location.search);
  const storyId = params.get('id');
  if (!storyId) return;
  const key = `storyLog_${storyId}`;
  const logs = JSON.parse(localStorage.getItem(key)) || [];
  const container = document.getElementById('logItems');
  if (!container) return;
  container.innerHTML = '';

  logs.forEach((log, index) => {
    const div = document.createElement('div');
    div.style.marginBottom = '0.5em';
    div.innerHTML = `
      <strong>${log.emotion}</strong> ${log.comment} <span style="color:#666;">(${log.date})</span>
      <button style="margin-left:1em;" onclick="deleteLog(${index})">ğŸ—‘ å‰Šé™¤</button>
    `;
    container.appendChild(div);
  });
})();

function deleteLog(index) {
  const params = new URLSearchParams(window.location.search);
  const storyId = params.get('id');
  if (!storyId) return;
  const key = `storyLog_${storyId}`;
  let logs = JSON.parse(localStorage.getItem(key)) || [];
  logs.splice(index, 1);
  localStorage.setItem(key, JSON.stringify(logs));
  location.reload();
}
  // ã‚¹ãƒˆãƒ¼ãƒªãƒ¼IDã«åŸºã¥ã„ã¦å°å™ºãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¨­å®š
  window.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(window.location.search);
    const storyId = params.get('id');
    const detailLink = document.getElementById('backToDetail');
    if (storyId && detailLink) {
      detailLink.href = `detail.html?id=${encodeURIComponent(storyId)}`;
    }
  });
</script>

</body>
</html>
